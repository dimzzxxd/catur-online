<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catur Hitam‚ÄëPutih Online</title>
  <!-- Chessboard.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/css/chessboard.min.css" integrity="sha512-kaKO40qC5YgCXSJ4gHtYgb9b0JY0UB3QWg9t5TszgKQBHV0SIFHxJ+A63HItDJSu7Z7ufMybX9tPyWpfFiVckA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body{font-family:system-ui,Helvetica,Arial,sans-serif;margin:0;padding:0;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh}
    header{padding:1rem;text-align:center}
    #board{max-width:90vw;width:350px;margin:0 auto;box-shadow:0 0 20px rgba(255,255,255,.3);border-radius:8px}
    .panel{width:100%;max-width:420px;padding:1rem}
    input,button{width:100%;padding:.8rem;border:none;border-radius:6px;font-size:1rem;margin-top:.5rem}
    input{background:#222;color:#fff}
    button{background:#fff;color:#000;font-weight:700;cursor:pointer}
    button:disabled{opacity:.4;cursor:not-allowed}
    .code-display{margin-top:.5rem;font-weight:700;font-size:1.2rem;letter-spacing:.1em;text-align:center}
  </style>
</head>
<body>
  <header>
    <h1>Catur Hitam‚ÄëPutih Online ‚ôüÔ∏è</h1>
  </header>
  <div id="board"></div>
  <section class="panel" id="lobby">
    <button id="createBtn">Buat Ruangan & Bagikan Kode</button>
    <div class="code-display" id="inviteCode" hidden></div>
    <input type="text" id="joinCode" placeholder="Masukkan kode ruangan...">
    <button id="joinBtn">Gabung</button>
  </section><!-- Dependensi --><script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js" integrity="sha512-kyR0Ol0gRzRJQvd/6KSbTJk6mxPgSC+IbUAc5IFadInrlvDmMt04BuuSNMhIccQm14gZ+CGX9B7K8+4B3pZ9nQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/js/chessboard.min.js" integrity="sha512-xVFi8j3GtRPoU4UVnAMvK11ibrT+oHiJ62VZFz6tItSfQOQ8rW09qEiXME3x+RqikvR2PT1AZLkZPT32H+30Ow==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Firebase SDK --><script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script><script>
  /* ===== 1. Konfigurasi Firebase ===== */
  // Ganti value berikut dengan konfigurasi proyek Firebase kamu ‚ö†Ô∏è
  const firebaseConfig = {
  apiKey: "AIzaSyDI7I6ZDOa8_LLCSMEHyBlTJp92z8js67c",
  authDomain: "catur-67f19.firebaseapp.com",
  projectId: "catur-67f19",
  storageBucket: "catur-67f19.firebasestorage.app",
  messagingSenderId: "768380276237",
  appId: "1:768380276237:web:ec95c6263375ab1ae0cf44",
  measurementId: "G-47R9P25VK7"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /* ===== 2. Variabel Global ===== */
  const chess = new Chess();
  let board;           // chessboard.js instance
  let roomCode;        // string kode ruangan
  let myColor = 'white';// warna pemain ini
  let roomRef;         // referensi database ruangan
  let isMyTurn = false;

  /* ===== 3. Fungsi Util ===== */
  const genCode = len=>Math.random().toString(36).substring(2,2+len).toUpperCase();
  const qs = sel=>document.querySelector(sel);

  /* ===== 4. Setup Board ===== */
  function initBoard(){
    board = Chessboard('board',{
      draggable:true,
      position:'start',
      orientation:myColor,
      pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
      onDragStart:(src, piece)=>{
        if(!isMyTurn) return false;
        if(myColor==='white' && piece.search(/^b/)!==-1) return false;
        if(myColor==='black' && piece.search(/^w/)!==-1) return false;
      },
      onDrop:(src,dst)=>{
        const move = chess.move({from:src,to:dst,promotion:'q'});
        if(move===null){return 'snapback';}
        pushState();
        isMyTurn=false;
      },
      onSnapEnd:()=> board.position(chess.fen())
    });
  }

  /* ===== 5. Firebase Helpers ===== */
  async function createRoom(){
    try{
      if(firebaseConfig.apiKey.startsWith('YOUR')){
        alert('‚ö†Ô∏è Kamu belum mengisi konfigurasi Firebase. Edit variabel firebaseConfig dulu, ya!');
        return;
      }
      roomCode = genCode(6);
      myColor = 'white';
      roomRef = db.ref('rooms/'+roomCode);
      await roomRef.set({fen: chess.fen(), turn:'w'});
      roomRef.on('value', handleUpdate);
      qs('#inviteCode').hidden = false;
      qs('#inviteCode').textContent = roomCode;
      transitionToGame();
    }catch(err){
      console.error(err);
      alert('Gagal membuat ruangan ‚Üí '+err.message+'
‚Ä¢ Pastikan koneksi internet oke
‚Ä¢ Cek konfigurasi Firebase & Rules Realtime Database');
    }
  });
    roomRef.on('value',handleUpdate);
    qs('#inviteCode').hidden=false;
    qs('#inviteCode').textContent=roomCode;
    transitionToGame();
  }

  async function joinRoom(code){
    try{
      roomCode = code.toUpperCase();
      roomRef = db.ref('rooms/'+roomCode);
      const snap = await roomRef.once('value');
      if(!snap.exists()){
        alert('Ruangan tidak ditemukan üò¢');
        return;
      }
      myColor = 'black';
      chess.load(snap.val().fen);
      board.position(chess.fen());
      roomRef.on('value', handleUpdate);
      transitionToGame();
    }catch(err){
      console.error(err);
      alert('Gagal join ruangan ‚Üí '+err.message+'
Cek koneksi & konfigurasi Firebase');
    }
  }
    myColor='black';
    chess.load(snap.val().fen);
    board.position(chess.fen());
    roomRef.on('value',handleUpdate);
    transitionToGame();
  }

  function pushState(){
    roomRef.set({fen: chess.fen(), turn: chess.turn()});
  }

  function handleUpdate(snap){
    const data=snap.val();
    if(!data) return;
    chess.load(data.fen);
    board.position(chess.fen());
    isMyTurn = (data.turn==='w' && myColor==='white') || (data.turn==='b' && myColor==='black');
  }

  /* ===== 6. UI Transitions ===== */
  function transitionToGame(){
    qs('#lobby').style.display='none';
    initBoard();
    handleUpdate({val:()=>({fen: chess.fen(), turn:'w'})});
  }

  /* ===== 7. Event Listeners ===== */
  qs('#createBtn').onclick=createRoom;
  qs('#joinBtn').onclick=()=>{
    const code=qs('#joinCode').value.trim();
    if(code.length<4){alert('Kode kurang valid');return;}
    joinRoom(code);
  };
</script></body>
</html>
